# MHW2Wiki 技术架构方案

## 🎯 设计目标

打造**简洁、现代、高效、宝塔面板友好**的《怪物猎人》资料库网站。

## 🏗️ 核心架构

### 架构原则
- **去复杂化**: 移除不必要的抽象层，直接嵌入多语言支持
- **高性能**: 使用批量操作、缓存策略、静态生成
- **易维护**: 清晰的代码结构，充分的类型安全
- **现代化**: 采用最新的技术栈和最佳实践

### 技术栈 (无 Docker，宝塔面板友好)

| 层级 | 技术选型 | 版本 | 部署方式 |
|------|----------|------|----------|
| **前端** | Next.js + Tailwind CSS + shadcn/ui | 14.x | 静态导出 + Nginx |
| **后端** | NestJS + GraphQL + Prisma | 10.x | PM2 进程管理 |
| **数据库** | PostgreSQL + Prisma ORM | 15+ | 宝塔面板软件商店 |
| **部署** | 宝塔面板 + PM2 + Nginx | - | 无容器化依赖 |

### 架构优势
- **高性能**: 前端静态生成，访问速度极快
- **高安全**: 减少服务端动态渲染攻击面
- **易扩展**: 前后端独立开发部署，职责清晰
- **零运维**: 宝塔面板一键管理，无复杂配置

## 📂 项目结构

```
mhw2wiki/
├── apps/
│   ├── backend/         # NestJS + GraphQL API
│   └── frontend/        # Next.js + Tailwind 前端
├── packages/
│   ├── database/        # Prisma ORM + 数据导入脚本
│   ├── eslint-config/   # 共享 ESLint 配置
│   ├── typescript-config/# 共享 TypeScript 配置
│   └── ui/              # 共享 UI 组件库
├── output/merged/       # 游戏数据 JSON 文件
├── config/              # Nginx 配置模板
├── scripts/             # 部署和备份脚本
└── docs/                # 项目文档
```

## 📊 数据架构

### 数据规模
- **总记录数**: 13万+ 条游戏数据
- **数据文件**: 14个主要JSON文件
- **多语言**: 支持14种语言

### Schema 设计原则
- **极简关系**: 减少复杂关联，提升查询性能
- **JSON嵌入**: 使用PostgreSQL JSONB存储多语言和复杂数据
- **类型安全**: Prisma确保端到端类型安全

## 🔄 开发流程

### 开发阶段
1. **数据层** (已完成) - Prisma Schema + 数据导入
2. **后端API** (开发中) - NestJS + GraphQL 
3. **前端UI** (计划中) - Next.js + 组件开发
4. **部署优化** (最终) - 宝塔面板生产环境

### 质量保证
- **代码质量**: ESLint + Prettier + TypeScript严格模式
- **测试策略**: Jest单元测试 + Playwright E2E
- **性能目标**: 首屏<2s，API响应<500ms，Lighthouse>90

## 🚀 部署策略

### 生产环境
- **服务器**: 宝塔面板管理的Linux服务器
- **进程管理**: PM2自动重启和负载均衡
- **反向代理**: Nginx静态文件服务和API代理
- **数据库**: PostgreSQL主从复制和定时备份

### 监控运维
- **性能监控**: PM2内置监控 + 自定义指标
- **日志管理**: 结构化日志 + 日志轮转
- **备份策略**: 数据库备份 + 代码备份 + 配置备份

## 💡 技术决策

### 为什么选择这套技术栈？

1. **Next.js App Router**
   - 最新的React Server Components支持
   - 静态导出无服务端依赖
   - 优秀的SEO和性能表现

2. **NestJS + GraphQL**
   - 企业级Node.js框架
   - GraphQL避免REST API的over-fetching
   - Code-First确保类型安全

3. **PostgreSQL + Prisma**
   - 成熟稳定的关系型数据库
   - Prisma提供优秀的TypeScript支持
   - JSONB字段支持复杂数据结构

4. **宝塔面板部署**
   - 国内用户友好的服务器管理
   - 可视化操作降低运维成本
   - 丰富的插件生态

### 避免的技术选择

- ❌ **Docker容器化**: 增加宝塔面板用户的学习成本
- ❌ **微服务架构**: 项目规模不需要复杂的服务拆分
- ❌ **Redis缓存**: 使用内存缓存避免额外的依赖
- ❌ **复杂的CI/CD**: 使用简单的Webhook自动部署

## 📈 扩展规划

### 短期目标 (3个月)
- 完成后端API开发 (所有GraphQL接口)
- 完成前端页面开发 (11个核心页面)
- 完成生产环境部署和监控

### 中期目标 (6个月)
- 性能优化和用户体验提升
- 移动端PWA支持
- 多语言界面支持

### 长期目标 (12个月)
- 社区功能 (用户注册、收藏、评论)
- 数据API开放平台
- 多游戏数据支持扩展

---

*本文档定期更新，版本：v6.0*
